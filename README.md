# generalpackager

<pre>
<a href='#generalpackager'>generalpackager</a>  
├─ <a href='#Description'>Description</a>  
├─ <a href='#Badges'>Badges</a>  
├─ <a href='#Installation'>Installation</a>  
│  └─ <a href='#Extras'>Extras</a>  
├─ <a href='#Todos'>Todos</a>  
└─ <a href='#Public-attributes'>Public attributes</a>  
   └─ <a href='#Namespace'>Namespace</a>  
      ├─ <a href='#Class-GitHub'>Class: GitHub</a>  
      ├─ <a href='#Class-LocalModule'>Class: LocalModule</a>  
      ├─ <a href='#Class-LocalRepo'>Class: LocalRepo</a>  
      └─ <a href='#Class-Packager'>Class: Packager</a>
</pre>

## Description
Tools to interface GitHub, PyPI, local repos and local modules.

## Badges
| UnitTests                                                                                                                                                               | Alerts                                                                                                                                                                                | Commit                                                                                          | Release                                                                                                                    | Python                                                                                                                          | Operating System                                                                                                              |
|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:------------------------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------|:------------------------------------------------------------------------------------------------------------------------------|
| [![workflow Actions Status](https://github.com/ManderaGeneral/generalpackager/workflows/workflow/badge.svg)](https://github.com/ManderaGeneral/generalpackager/actions) | [![Total alerts](https://img.shields.io/lgtm/alerts/g/ManderaGeneral/generalpackager.svg?logo=lgtm&logoWidth=18)](https://lgtm.com/projects/g/ManderaGeneral/generalpackager/alerts/) | ![GitHub last commit](https://img.shields.io/github/last-commit/ManderaGeneral/generalpackager) | [![PyPI version shields.io](https://img.shields.io/pypi/v/generalpackager.svg)](https://pypi.org/project/generalpackager/) | [![PyPI pyversions](https://img.shields.io/pypi/pyversions/generalpackager.svg)](https://pypi.python.org/pypi/generalpackager/) | [![Generic badge](https://img.shields.io/badge/platforms-Windows%20%7C%20Ubuntu%20%7C%20MacOS-blue.svg)](https://shields.io/) |

## Installation
```
pip install generalpackager
```

### Extras
| Name    | Command                                | Extra packages             |
|:--------|:---------------------------------------|:---------------------------|
| testing | `pip install generalpackager[testing]` | `hello`, `there` and `foo` |
| another | `pip install generalpackager[another]` | `omg` and `hello`          |

## Todos
| Module        | Message                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|:--------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| packager.py   | Inherit future crawler class for pypi and github.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| packager.py   | Allow github, pypi or local repo not to exist in any combination.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| shelved.patch | Inherit future crawler class for pypi and github. \"\"\"\r\n    def get_badges_dict(self):\r\n        \"\"\" Get badges as a dict.\r\n\r\n            :param Packager self: \"\"\"\r\n        badges = {\r\n            \"UnitTests\": \"[![workflow Actions Status](https://github.com/ManderaGeneral/PACKAGE/workflows/workflow/badge.svg)](https://github.com/ManderaGeneral/PACKAGE/actions)\",\r\n            \"Alerts\": \"[![Total alerts](https://img.shields.io/lgtm/alerts/g/ManderaGeneral/PACKAGE.svg?logo=lgtm&logoWidth=18)](https://lgtm.com/projects/g/ManderaGeneral/PACKAGE/alerts/)\",\r\n            \"Commit\": \"![GitHub last commit](https://img.shields.io/github/last-commit/ManderaGeneral/PACKAGE)\",\r\n            \"Release\": \"[![PyPI version shields.io](https://img.shields.io/pypi/v/PACKAGE.svg)](https://pypi.org/project/PACKAGE/)\",\r\n            \"Python\": \"[![PyPI pyversions](https://img.shields.io/pypi/pyversions/PACKAGE.svg)](https://pypi.python.org/pypi/PACKAGE/)\",\r\n            \"Operating System\": \"[![Generic badge](https://img.shields.io/badge/platforms-Windows%20%7C%20Ubuntu%20%7C%20MacOS-blue.svg)](https://shields.io/)\",\r\n        }\r\n        return {key: value.replace(\"PACKAGE\", self.name) for key, value in badges.items()}\r\n\r\n    def get_installation_markdown(self):\r\n        \"\"\" Get install markdown.\r\n\r\n            :param Packager self: \"\"\"\r\n        markdown = Markdown(header=\"Installation\").add_code_lines(f'pip install {self.name}')\r\n\r\n        if len(self.metadata.extras_require) > 1:\r\n            list_of_dicts = [{\r\n                \"Name\": extra,\r\n                \"Command\": f\"`pip install {self.name}[{extra}]`\",\r\n                \"Extra packages\": comma_and_and(*[f\"`{x}`\" for x in requires], period=False),\r\n            } for extra, requires in self.metadata.extras_require.items()]\r\n\r\n            Markdown(header=\"Extras\", parent=markdown).add_table_lines(*list_of_dicts)\r\n\r\n        return markdown\r\n\r\n    def get_topics_markdown(self, parent=None):\r\n        \"\"\" Get topics markdown.\r\n\r\n            :param Packager self:\r\n            :param parent: \"\"\"\r\n        print(self.metadata.topics)\r\n\r\n    def get_table_of_contents(self, markdown):\r\n        \"\"\" Get table of contents lines.\r\n\r\n            :param Packager self:\r\n            :param markdown: \"\"\"\r\n        return markdown.view(custom_repr=lambda md: md.link(md.header), spacer=\" \", print_out=False).replace(\"\\n\", \"  \\n\").splitlines()\r\n\r\n    def generate_readme(self):\r\n        \"\"\" Create readme markdown object.\r\n\r\n            :param Packager self: \"\"\"\r\n        markdown = Markdown(header=self.name)\r\n\r\n        # Description\r\n        Markdown(self.metadata.description, header=\"Description\", parent=markdown)\r\n\r\n        # Badges\r\n        Markdown(header=\"Badges\", parent=markdown).add_table_lines(self.get_badges_dict())\r\n\r\n        # Installation\r\n        self.get_installation_markdown().set_parent(parent=markdown)\r\n\r\n        # Todos\r\n        Markdown(header=\"Todos\", parent=markdown).add_table_lines(*self.localrepo.get_todos())\r\n\r\n        # Attributes\r\n        self.localmodule.get_attributes_markdown().set_parent(parent=markdown)\r\n\r\n        # Table of contents\r\n        Markdown(*self.get_table_of_contents(markdown)).set_parent(parent=markdown).set_index(0)\r\n\r\n        return markdown\r\n\r\n    def sync_github_metadata(self):\r\n        \"\"\" Sync GitHub with local metadata.\r\n\r\n            :param Packager self: \"\"\"\r\n        self.github.set_website(f\"https://pypi.org/project/{self.name}/\")\r\n        self.github.set_description(self.metadata.description)\r\n        self.github.set_topics(self.metadata.topics)\r\n\r\n\r\n\r\nclass _Metadata:\r\n    name = ...\r\n    version = ...\r\n    description = ...\r\n    install_requires = ...\r\n    extras_require = ...\r\n    classifiers = ...\r\n    topics = ...\r\n\r\n    def __init__(self, packager):\r\n        self.packager = packager\r\n\r\n        for key, value in self.packager.localrepo.get_metadata_path().read().items():\r\n            setattr(self, key, value)\r\n\r\n        for key in dir(self):\r\n            if getattr(self, key) is Ellipsis:\r\n                raise AssertionError(f\"Key '{key}' for {self.packager}'s metadata is still ...\")\r\n\r\n\r\n@initBases\r\nclass Packager(_PackagerMarkdown):\r\n    \"\"\" Uses APIs to manage 'general' package.\r\n        Todo: Allow github, pypi or local repo not to exist in any combination. \"\"\"\r\n    def __init__(self, name, repos_path=None):\r\n        if repos_path is None:\r\n            repos_path = Path().absolute().get_parent()\r\n\r\n        self.name = name\r\n        self.repos_path = repos_path\r\n\r\n        self.github = GitHub(name=name)\r\n        self.localrepo = LocalRepo(path=repos_path / name)\r\n        self.localmodule = LocalModule(module=importlib.import_module(name=name))\r\n        self.pypi = PyPI(name=name)\r\n\r\n        self.metadata = _Metadata(packager=self)\r\n\r\n        assert self.metadata.name == self.name\r\n\r\n    def setup_all(self):\r\n        \"\"\" Called by GitHub Actions when a commit is pushed. \"\"\"\r\n        self.localrepo.get_readme_path().text.write(self.generate_readme(), overwrite=True)\r\n        # self.commit_and_push()\r\n\r\n        # self.sync_github_metadata()\r\n\r\n        # HERE ** TOC links\r\n        # 2 HERE ** Release history from commits\r\n        # 3 HERE ** Generate classifiers from topics\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n |

## Public attributes

### Namespace
| Name                              | Doc                                                     |
|:----------------------------------|:--------------------------------------------------------|
| [GitHub](#Class-GitHub)           | Tools to interface a GitHub Repository.                 |
| [LocalModule](#Class-LocalModule) | Tools to interface a Local Python Module.               |
| [LocalRepo](#Class-LocalRepo)     | Tools to help Path interface a Local Python Repository. |
| [Packager](#Class-Packager)       | Uses APIs to manage 'general' package.                  |
| PyPI                              | Tools to interface pypi.org.                            |
<hr>

#### Class: GitHub
| Method          | Doc                                                   |
|:----------------|:------------------------------------------------------|
| get_description | Get a string of description in the GitHub repository. |
| get_topics      | Get a list of topics in the GitHub repository.        |
| get_website     | Get website specified in repository details.          |
| set_description | Set a description for the GitHub repository.          |
| set_topics      | Set a list of topics for the GitHub repository.       |
| set_website     | Set a website for the GitHub repository.              |

#### Class: LocalModule
| Method                  | Doc                      |
|:------------------------|:-------------------------|
| get_attributes_markdown | Get attributes markdown. |

#### Class: LocalRepo
| Method            | Doc                                                                                                               |
|:------------------|:------------------------------------------------------------------------------------------------------------------|
| get_local_repos   | Return a list of local repos in given folder.                                                                     |
| get_metadata_path | Get a Path instance pointing to README, regardless if it exists.                                                  |
| get_package_paths | Get a list of Paths pointing to each folder containing a Python file in this local repo, aka `namespace package`. |
| get_readme_path   | Get a Path instance pointing to README, regardless if it exists.                                                  |
| get_todos         | Get a list of dicts containing cleaned up todos.                                                                  |
| path_is_repo      | Return whether this path is a local repo.                                                                         |

#### Class: Packager
| Method                         | Doc                                               |
|:-------------------------------|:--------------------------------------------------|
| generate_readme                | Create readme markdown object.                    |
| get_badges_dict                | Get badges as a dict.                             |
| get_installation_markdown      | Get install markdown.                             |
| get_table_of_contents_markdown | Get table of contents lines.                      |
| setup_all                      | Called by GitHub Actions when a commit is pushed. |
| sync_github_metadata           | Sync GitHub with local metadata.                  |